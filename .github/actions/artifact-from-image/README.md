# Save Docker Image to Artifact Action

This GitHub Action saves a specified Docker image as a `.tar` file and uploads it as an artifact, enabling seamless image storage and retrieval across workflows.

## Features

- Exports Docker images as `.tar` files.
- Automatically generates deterministic artifact names from the image name/tag.
- Uploads the saved image as an artifact for later jobs.
- Appends a short summary to the workflow run so consumers can quickly see the artifact that was produced.

## Inputs

| Name    | Description                                                                          | Required | Default |
|---------|--------------------------------------------------------------------------------------|----------|---------|
| `image` | Docker image name (e.g., `repo/image:tag`). If no tag is provided, `latest` is used. | Yes      |         |

## Outputs

| Name       | Description                                      |
|------------|--------------------------------------------------|
| `artifact` | Reference to the uploaded artifact (`name/path`) |

## How It Works

1. Extracts the image name and tag from the input and prepares an artifact name/path pair.
2. Saves the specified Docker image as a `.tar` file using `docker save`.
3. Uploads the `.tar` file as an artifact with `actions/upload-artifact` and writes a short summary section.

Pair this action with [`artifact-to-image`](../artifact-to-image) or the `docker-push` composite to move the built image across workflow boundaries.

## Usage

### Basic Example

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    outputs:
      artifact: ${{ steps.upload.outputs.artifact }}
    steps:
      - name: Build Docker image
        run: docker build -t myrepo/myimage:1.0 .

      - name: Save and upload Docker image
        id: upload
        uses: draftm0de/github.workflows/.github/actions/artifact-from-image@main
        with:
          image: myrepo/myimage:1.0
```

### With docker-build Action

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    outputs:
      artifact: ${{ steps.upload.outputs.artifact }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build docker image
        id: build
        uses: draftm0de/github.workflows/.github/actions/docker-build@main
        with:
          image: myrepo/myimage:1.0
          context: .

      - name: Upload docker image to artifact
        id: upload
        uses: draftm0de/github.workflows/.github/actions/artifact-from-image@main
        with:
          image: ${{ steps.build.outputs.image }}
```

### Cross-Job Usage

```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    outputs:
      artifact: ${{ steps.upload.outputs.artifact }}
    steps:
      - name: Build and save
        id: upload
        uses: draftm0de/github.workflows/.github/actions/artifact-from-image@main
        with:
          image: myrepo/myimage:1.0

  push:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Load Docker image
        id: download
        uses: draftm0de/github.workflows/.github/actions/artifact-to-image@main
        with:
          artifact: ${{ needs.build.outputs.artifact }}

      - name: Push to registry
        uses: draftm0de/github.workflows/.github/actions/docker-push@main
        with:
          image: ${{ steps.download.outputs.image }}
          tags: v1.0.0 latest
          registry: ghcr.io
          password: ${{ secrets.GITHUB_TOKEN }}
```

## Output Format

The `artifact` output is in `name/path` format (e.g., `myrepo-myimage-1-0/image.tar`), making it easy to pass to [`artifact-to-image`](../artifact-to-image) or consume in downstream jobs.

## Notes

- Artifact names are generated by replacing `/` and `.` with `-` in the image name
- If no tag is provided, `:latest` is assumed
- The action writes a summary to `$GITHUB_STEP_SUMMARY` showing the image and artifact reference
